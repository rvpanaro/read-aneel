---
title: "read_aneel"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Análise exploratória da base de dados do relatório de indicadores de 
sustentatibilidade econômico-financeiros - ANEEL 

Dada a necessidade de sistematização do monitoramento econômico-financeiro, a 
ANEEL compila uma base de dados com variáveis financeiras e operacionais das 
empresas distribuidoras de energia elétrica. As bases estão presentes em cinco
arquivos .xlsx e apresentam dados anuais para cada empresa até 2016 e trimestrais
desde então. Embora a base de dados tenha um grande número de variáveis disponíveis, os 
indicadores selecionados pela 5a Edição do Relatório de Indicadores de Sustentabilidade Econômico-Financeira das Distribuidoras (pg 28):

![](./img/indicadores.png)

## Análise de consistência 

A verificação de consistência é uma avaliação realizada para indicar se os dados apresentados apresentam algum conflito interno ou incoerência. Nesse sentido, esta seção tem como objetivo averiguar a qualidade e relatar problemas ou erros no conjunto de dados fornecido pela ANEEL.

- Variáveis Repetidas

```{r, echo = F, warning = FALSE, message = F}

library(data.table); library(dplyr)

  # File and sheet location

  sheet <- "Base Dados"
  folder_path <- "/home/renatovp/Dropbox/Cemig 2.0/BaseDadosANEEL/Base em Excel"
  
  # Get file path for all documents in the folder
  path_files <- list.files(folder_path, full.names = T, pattern = ".xlsx") 
  
  # Read all files
  
  file_dump <- lapply(path_files, function(x) readxl::read_xlsx(path = x, sheet = sheet, skip = 5, col_names = F )) # Note that it takes column names as first observation of dataset
  
  col_names <- NULL
  
  for(i in 1:length(path_files)){
      col_names[[i]] <- data.frame(col = t(file_dump[[i]][1,]), file = path_files[i])
  }
  
  # Binds every file in folder path 
  col_names <- data.table::rbindlist(col_names); 

  # Keeps table good-looking
  
  tab <- addmargins(table(col_names$col, col_names$file))
  colnames(tab) <-c("A1", "A2", "A3", "A4", "A5", "Total")
  i <- c(order(tab[,6], decreasing = T)[-1], dim(tab)[1])
  
  rownames(tab)[which(rownames(tab) == "Sum")] <- "Total"
  
  pander::pander(tab[i,])
```

  - Tabela de contingência do número de variáveis selecionadas por tabela.
- Mesma entrada com valores diferentes em anos diferentes.
  - Exemplo da Cemig.

## Análise descritiva

Prosseguiremos agora para a análise descritiva da base de dados.
Numa tentativa de contornar os problemas previamente citados, assumimos algumas 
premissas:

- Os dados mais recentes são mais confiáveis e serão utilizados quando houver 
valores repetidos para uma determinada entrada no banco de dados.
- Quando o valor não estiver disponível (NA) na base mais recente, a última entrada
válida será considerada.
- A primeira coluna com um determinado nome de variável será selecionada.

```{r data-last}
# dt <- read.csv("dados_last_not_na.csv")
```

- Histogramas das variáveis.
- Correlograma - Elipse.
- Série temporal das variáveis selecionadas para a Cemig.
